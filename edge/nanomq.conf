# NanoMQ Configuration â€” Edge MQTT Broker
# Bridges to cloud EMQX via MQTT 5.0 over QUIC

listeners.tcp {
    bind = "0.0.0.0:1883"
}

listeners.ws {
    bind = "0.0.0.0:8083"
}

# MQTT Bridge to Cloud EMQX
bridges.mqtt.emqx {
    server = "mqtt-quic://emqx.cloud:14567"
    proto_ver = 5
    keepalive = 60s
    clean_start = true
    username = ""
    password = ""

    # Forward prediction topics to cloud
    forwards = [
        {
            remote_topic = "dt/edge/+/predictions"
            local_topic = "dt/edge/+/predictions"
            qos = 1
        },
        {
            remote_topic = "dt/edge/+/telemetry"
            local_topic = "dt/edge/+/telemetry"
            qos = 0
        }
    ]

    # Receive config and OTA commands from cloud
    subscription = [
        {
            remote_topic = "dt/cloud/config/+"
            local_topic = "dt/cloud/config/+"
            qos = 1
        },
        {
            remote_topic = "dt/cloud/ota/+"
            local_topic = "dt/cloud/ota/+"
            qos = 1
        }
    ]

    # QUIC transport settings
    quic_keepalive = 120s
    quic_idle_timeout = 120s
    quic_handshake_timeout = 60s
    quic_multi_stream = true
}

log {
    to = [file, console]
    level = warn
    dir = "/tmp/nanomq"
    file = "nanomq.log"
}
